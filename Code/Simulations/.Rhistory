n_reps <- results[[1]]$n_reps
points <- results[[1]]$points
values <- results[[1]]$values
estimates_mat <- purrr::map(.x = results, .f = ~ do.call(cbind, .x$estimates))
estimates_tibbles <- purrr::map(.x = indices, .f = ~ cbind(tibble(
cov1 = points[, 1], cov2 = points[, 2],
vals = values
), estimates_mat[[.x]]) %>%
pivot_longer(cols = !c("cov1", "cov2", "vals"), names_to = "Simulation Run", values_to = "Estimate"))
# Calculate Statistics for each point
estimates_avgs <- purrr::map(.x = estimates_mat, .f = ~ rowMeans(.x))
estimates_bias <- purrr::map(.x = indices, .f = ~ estimates_avgs[[.x]] - values)
estimates_vars <- purrr::map(
.x = indices,
.f = function(x) unlist(purrr::map(1:nrow(points), .f = function(y) var(estimates_mat[[x]][y, ])))
)
# Create Tibble with Statistics
stat_tibble <- purrr::map(
.x = indices,
.f = ~ tibble(
cov1 = points[, 1], cov2 = points[, 2],
avgs = estimates_avgs[[.x]], bias = estimates_bias[[.x]], vars = estimates_vars[[.x]]
)
)
# Calculate Scales for Fill-Legends
limits_bias_u <- unlist(purrr::map(.x = indices, .f = ~max(stat_tibble[[.x]]$bias)))
limits_bias_l <- unlist(purrr::map(.x = indices, .f = ~min(stat_tibble[[.x]]$bias)))
limits_vars <- unlist(purrr::map(.x = indices, .f = ~max(stat_tibble[[.x]]$vars)))
# Create Plots of Statistics
# Plot Bias Surface
est_bias_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]]) +
geom_contour_fill(aes(x = cov1, y = cov2, z = bias),
bins = 100
) +
scale_fill_distiller(palette = "Spectral") +
xlab("Covariate 1") +
ylab("Covariate 2") +
labs(fill = "Estimator Bias") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Plot Estimator Variance Surface
est_var_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]]) +
geom_contour_fill(aes(x = cov1, y = cov2, z = vars),
bins = 100
) +
scale_fill_distiller(palette = "RdBu", direction = -1) +
xlab("Covariate 1") +
ylab(element_blank()) +
labs(fill = "Estimator Variance") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Combine Plots for Paper
comb_plots <- purrr::map(.x = indices,
.f = ~ est_bias_plots[[.x]] + est_var_plot[[.x]])
# Combine Plots for Paper
comb_plots <- purrr::map(.x = indices,
.f = ~ est_bias_plots[[.x]] + est_var_plots[[.x]])
comb_plots[[2]]
comb_plots[[1]]
comb_plots[[3]]
comb_plots[[2]]
comb_plots[[1]]
comb_plots[[2]]
limits_bias <- max(abs(limits_bias_u, limits_bias_u))
limits_bias <- unlist(purrr::map(.x = indices, .f = ~max(abs(c(limits_bias_l[.x], limits_bias_u[.x])))))
# Create Plots of Statistics
# Plot Bias Surface
est_bias_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]]) +
geom_contour_fill(aes(x = cov1, y = cov2, z = bias),
bins = 100
) +
scale_fill_distiller(palette = "Spectral", limit = limits_bias[.x]) +
xlab("Covariate 1") +
ylab("Covariate 2") +
labs(fill = "Estimator Bias") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
est_bias_plots[[1]]
# Create Plots of Statistics
# Plot Bias Surface
est_bias_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]]) +
geom_contour_fill(aes(x = cov1, y = cov2, z = bias),
bins = 100
) +
scale_fill_distiller(palette = "Spectral", limit = limits_bias[.x]) +
xlab("Covariate 1") +
ylab("Covariate 2") +
labs(fill = "Estimator Bias") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Create Plots of Statistics
# Plot Bias Surface
est_bias_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]]) +
geom_contour_fill(aes(x = cov1, y = cov2, z = bias),
bins = 100
) +
scale_fill_distiller(palette = "Spectral", limit = c(-1,1)*limits_bias[.x]) +
xlab("Covariate 1") +
ylab("Covariate 2") +
labs(fill = "Estimator Bias") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
est_bias_plots[[1]]
est_bias_plots[[2]]
est_bias_plots[[3]]
est_bias_plots[[2]]
est_bias_plots[[1]]
?scale_fill_gradient2
bias_colors <- list(c('green', 'red'), c('blue', 'orange'), c('purple', 'yellow'))
# Create Plots of Statistics
# Plot Bias Surface
est_bias_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]]) +
geom_contour_fill(aes(x = cov1, y = cov2, z = bias),
bins = 100
) +
#scale_fill_distiller(palette = "Spectral", limit = c(-1,1)*limits_bias[.x]) +
scale_fill_gradient2(low = bias_colors[[.x]][1], high = bias_colors[[.x]][2], midpoint = 0, limit = c(-1,1)*limits_bias[.x]) +
xlab("Covariate 1") +
ylab("Covariate 2") +
labs(fill = "Estimator Bias") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
est_bias_plots[[1]]
est_bias_plots[[2]]
est_bias_plots[[3]]
est_bias_plots[[2]]
est_bias_plots[[1]]
# Plot Estimator Variance Surface
est_var_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]]) +
geom_contour_fill(aes(x = cov1, y = cov2, z = vars),
bins = 100
) +
#scale_fill_distiller(palette = "RdBu", direction = -1) +
scale_fill_gradient2(low = 'white', high = bias_colors[[.x]][2], limit = c(0, limits_vars[.x])) +
xlab("Covariate 1") +
ylab(element_blank()) +
labs(fill = "Estimator Variance") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Combine Plots for Paper
comb_plots <- purrr::map(.x = indices,
.f = ~ est_bias_plots[[.x]] + est_var_plots[[.x]])
comb_plots[[1]]
comb_plots[[2]]
comb_plots[[3]]
comb_plots[[1]]
comb_plots[[2]]
comb_plots[[3]]
# Create Plots of Statistics
# Plot Bias Surface
est_bias_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]]) +
geom_contour_fill(aes(x = cov1, y = cov2, z = bias),
bins = 100
) +
geom_contour(color = "black", size = 0.1) +
#scale_fill_distiller(palette = "Spectral", limit = c(-1,1)*limits_bias[.x]) +
scale_fill_gradient2(low = bias_colors[[.x]][1], high = bias_colors[[.x]][2], midpoint = 0, limit = c(-1,1)*limits_bias[.x]) +
xlab("Covariate 1") +
ylab("Covariate 2") +
labs(fill = "Estimator Bias") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Plot Estimator Variance Surface
est_var_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]]) +
geom_contour_fill(aes(x = cov1, y = cov2, z = vars),
bins = 100
) +
geom_contour(color = "black", size = 0.1) +
#scale_fill_distiller(palette = "RdBu", direction = -1) +
scale_fill_gradient2(low = 'white', high = bias_colors[[.x]][2], limit = c(0, limits_vars[.x])) +
xlab("Covariate 1") +
ylab(element_blank()) +
labs(fill = "Estimator Variance") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Combine Plots for Paper
comb_plots <- purrr::map(.x = indices,
.f = ~ est_bias_plots[[.x]] + est_var_plots[[.x]])
comb_plots[[3]]
# Create Tibble and matrix versions of Estimation results
indices <- 1:length(results)
n_reps <- results[[1]]$n_reps
points <- results[[1]]$points
values <- results[[1]]$values
estimates_mat <- purrr::map(.x = results, .f = ~ do.call(cbind, .x$estimates))
estimates_tibbles <- purrr::map(.x = indices, .f = ~ cbind(tibble(
cov1 = points[, 1], cov2 = points[, 2],
vals = values
), estimates_mat[[.x]]) %>%
pivot_longer(cols = !c("cov1", "cov2", "vals"), names_to = "Simulation Run", values_to = "Estimate"))
# Calculate Statistics for each point
estimates_avgs <- purrr::map(.x = estimates_mat, .f = ~ rowMeans(.x))
estimates_bias <- purrr::map(.x = indices, .f = ~ estimates_avgs[[.x]] - values)
estimates_vars <- purrr::map(
.x = indices,
.f = function(x) unlist(purrr::map(1:nrow(points), .f = function(y) var(estimates_mat[[x]][y, ])))
)
# Create Tibble with Statistics
stat_tibble <- purrr::map(
.x = indices,
.f = ~ tibble(
cov1 = points[, 1], cov2 = points[, 2],
avgs = estimates_avgs[[.x]], bias = estimates_bias[[.x]], vars = estimates_vars[[.x]]
)
)
# Calculate Scales for Fill-Legends
limits_bias_u <- unlist(purrr::map(.x = indices, .f = ~max(stat_tibble[[.x]]$bias)))
limits_bias_l <- unlist(purrr::map(.x = indices, .f = ~min(stat_tibble[[.x]]$bias)))
limits_bias <- unlist(purrr::map(.x = indices, .f = ~max(abs(c(limits_bias_l[.x], limits_bias_u[.x])))))
limits_vars <- unlist(purrr::map(.x = indices, .f = ~max(stat_tibble[[.x]]$vars)))
bias_colors <- list(c('green', 'red'), c('blue', 'orange'), c('purple', 'yellow'))
# Create Plots of Statistics
# Plot Bias Surface
est_bias_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]]) +
geom_contour_fill(aes(x = cov1, y = cov2, z = bias),
bins = 100
) +
geom_contour(color = "black", size = 0.1) +
#scale_fill_distiller(palette = "Spectral", limit = c(-1,1)*limits_bias[.x]) +
scale_fill_gradient2(low = bias_colors[[.x]][1], high = bias_colors[[.x]][2], midpoint = 0, limit = c(-1,1)*limits_bias[.x]) +
xlab("Covariate 1") +
ylab("Covariate 2") +
labs(fill = "Estimator Bias") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Plot Estimator Variance Surface
est_var_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]]) +
geom_contour_fill(aes(x = cov1, y = cov2, z = vars),
bins = 100
) +
geom_contour(color = "black", size = 0.1) +
#scale_fill_distiller(palette = "RdBu", direction = -1) +
scale_fill_gradient2(low = 'white', high = bias_colors[[.x]][2], limit = c(0, limits_vars[.x])) +
xlab("Covariate 1") +
ylab(element_blank()) +
labs(fill = "Estimator Variance") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Combine Plots for Paper
comb_plots <- purrr::map(.x = indices,
.f = ~ est_bias_plots[[.x]] + est_var_plots[[.x]])
comb_plots[[3]]
# Create Plots of Statistics
# Plot Bias Surface
est_bias_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]], aes(x = cov1, y = cov2, z = bias)) +
geom_contour_fill(bins = 100) +
geom_contour(color = "black", size = 0.1) +
#scale_fill_distiller(palette = "Spectral", limit = c(-1,1)*limits_bias[.x]) +
scale_fill_gradient2(low = bias_colors[[.x]][1], high = bias_colors[[.x]][2], midpoint = 0, limit = c(-1,1)*limits_bias[.x]) +
xlab("Covariate 1") +
ylab("Covariate 2") +
labs(fill = "Estimator Bias") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Plot Estimator Variance Surface
est_var_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]], aes(x = cov1, y = cov2, z = vars)) +
geom_contour_fill(bins = 100) +
geom_contour(color = "black", size = 0.1) +
#scale_fill_distiller(palette = "RdBu", direction = -1) +
scale_fill_gradient2(low = 'white', high = bias_colors[[.x]][2], limit = c(0, limits_vars[.x])) +
xlab("Covariate 1") +
ylab(element_blank()) +
labs(fill = "Estimator Variance") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Combine Plots for Paper
comb_plots <- purrr::map(.x = indices,
.f = ~ est_bias_plots[[.x]] + est_var_plots[[.x]])
comb_plots[[3]]
# Create Plots of Statistics
# Plot Bias Surface
est_bias_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]], aes(x = cov1, y = cov2, z = bias)) +
geom_contour_fill(bins = 100) +
geom_contour(color = "black", size = 0.1, bins = 100) +
#scale_fill_distiller(palette = "Spectral", limit = c(-1,1)*limits_bias[.x]) +
scale_fill_gradient2(low = bias_colors[[.x]][1], high = bias_colors[[.x]][2], midpoint = 0, limit = c(-1,1)*limits_bias[.x]) +
xlab("Covariate 1") +
ylab("Covariate 2") +
labs(fill = "Estimator Bias") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Plot Estimator Variance Surface
est_var_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]], aes(x = cov1, y = cov2, z = vars)) +
geom_contour_fill(bins = 100) +
geom_contour(color = "black", size = 0.1, bins = 100) +
#scale_fill_distiller(palette = "RdBu", direction = -1) +
scale_fill_gradient2(low = 'white', high = bias_colors[[.x]][2], limit = c(0, limits_vars[.x])) +
xlab("Covariate 1") +
ylab(element_blank()) +
labs(fill = "Estimator Variance") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Combine Plots for Paper
comb_plots <- purrr::map(.x = indices,
.f = ~ est_bias_plots[[.x]] + est_var_plots[[.x]])
comb_plots[[3]]
comb_plots[[2]]
comb_plots[[1]]
# Create Plots of Statistics
# Plot Bias Surface
est_bias_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]], aes(x = cov1, y = cov2, z = bias)) +
geom_contour_fill(bins = 100) +
geom_contour(color = "black", size = 0.1, bins = 20) +
#scale_fill_distiller(palette = "Spectral", limit = c(-1,1)*limits_bias[.x]) +
scale_fill_gradient2(low = bias_colors[[.x]][1], high = bias_colors[[.x]][2], midpoint = 0, limit = c(-1,1)*limits_bias[.x]) +
xlab("Covariate 1") +
ylab("Covariate 2") +
labs(fill = "Estimator Bias") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Plot Estimator Variance Surface
est_var_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]], aes(x = cov1, y = cov2, z = vars)) +
geom_contour_fill(bins = 100) +
geom_contour(color = "black", size = 0.1, bins = 20) +
#scale_fill_distiller(palette = "RdBu", direction = -1) +
scale_fill_gradient2(low = 'white', high = bias_colors[[.x]][2], limit = c(0, limits_vars[.x])) +
xlab("Covariate 1") +
ylab(element_blank()) +
labs(fill = "Estimator Variance") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Combine Plots for Paper
comb_plots <- purrr::map(.x = indices,
.f = ~ est_bias_plots[[.x]] + est_var_plots[[.x]])
comb_plots[[1]]
comb_plots[[2]]
comb_plots[[3]]
# Create Plots of Statistics
# Plot Bias Surface
est_bias_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]], aes(x = cov1, y = cov2, z = bias)) +
geom_contour_fill(bins = 100) +
geom_contour(color = "black", size = 0.1, bins = 15) +
#scale_fill_distiller(palette = "Spectral", limit = c(-1,1)*limits_bias[.x]) +
scale_fill_gradient2(low = bias_colors[[.x]][1], high = bias_colors[[.x]][2], midpoint = 0, limit = c(-1,1)*limits_bias[.x]) +
xlab("Covariate 1") +
ylab("Covariate 2") +
labs(fill = "Estimator Bias") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Plot Estimator Variance Surface
est_var_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]], aes(x = cov1, y = cov2, z = vars)) +
geom_contour_fill(bins = 100) +
geom_contour(color = "black", size = 0.1, bins = 20) +
#scale_fill_distiller(palette = "RdBu", direction = -1) +
scale_fill_gradient2(low = 'white', high = bias_colors[[.x]][2], limit = c(0, limits_vars[.x])) +
xlab("Covariate 1") +
ylab(element_blank()) +
labs(fill = "Estimator Variance") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Combine Plots for Paper
comb_plots <- purrr::map(.x = indices,
.f = ~ est_bias_plots[[.x]] + est_var_plots[[.x]])
comb_plots[[3]]
comb_plots[[3]]
comb_plots[[2]]
comb_plots[[1]]
# Create Plots of Statistics
# Plot Bias Surface
est_bias_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]], aes(x = cov1, y = cov2, z = bias)) +
geom_contour_fill(bins = 100) +
geom_contour(color = "black", size = 0.1, bins = 20) +
#scale_fill_distiller(palette = "Spectral", limit = c(-1,1)*limits_bias[.x]) +
scale_fill_gradient2(low = bias_colors[[.x]][1], high = bias_colors[[.x]][2], midpoint = 0, limit = c(-1,1)*limits_bias[.x]) +
xlab("Covariate 1") +
ylab("Covariate 2") +
labs(fill = "Estimator Bias") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Plot Estimator Variance Surface
est_var_plots <- purrr::map(
.x = indices,
.f = ~ ggplot(data = stat_tibble[[.x]], aes(x = cov1, y = cov2, z = vars)) +
geom_contour_fill(bins = 100) +
geom_contour(color = "black", size = 0.1, bins = 20) +
#scale_fill_distiller(palette = "RdBu", direction = -1) +
scale_fill_gradient2(low = 'white', high = bias_colors[[.x]][2], limit = c(0, limits_vars[.x])) +
xlab("Covariate 1") +
ylab(element_blank()) +
labs(fill = "Estimator Variance") +
theme_light() +
theme(
legend.position = "bottom", legend.key.size = unit(1.5, "cm"),
text = element_text(size = 16)
)
)
# Combine Plots for Paper
comb_plots <- purrr::map(.x = indices,
.f = ~ est_bias_plots[[.x]] + est_var_plots[[.x]])
comb_plots[[1]]
comb_plots[[2]]
comb_plots[[3]]
